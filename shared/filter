#!/bin/bash

FILTER_ONE='[.id, .start_date_local, .name, .distance, .gear_id, if .gear_id != null then $gear[.gear_id] else "none" end, .private] | map(tostring) | @tsv'

filter_one() {
  local gear=$1
  filter_activity "$gear" "$FILTER_ONE"
}

filter_many() {
  local gear=$1
  filter_activity "$gear" ".[] | $FILTER_ONE"
}

filter_activity() {
  local gear=${1:-'{}'}
  local filter=$2
  jq -r --argjson gear "$gear" "$filter"
}

filter_gear() {
  local jq_filter='[.bikes | .[] | {(.id): .name}] | add'
  jq -rc "$jq_filter"
}
